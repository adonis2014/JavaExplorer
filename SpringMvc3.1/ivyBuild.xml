<?xml version="1.0" encoding="GB18030"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="Spring3MvcSample" default="native" basedir=".">

	<description>Spring3.1 MVC sample.</description>

	<import file="../base.xml" />

	<property name="tomcat.home" location="${env.TOMCAT_HOME}"/>

	<property name="spring.version" value="3.2.3.RELEASE"/>

	<target name="initialize" depends="baseBuild.initialize">
		<ivy:cachepath conf="compile" pathid="compile-classpath" />
		<ivy:cachepath conf="test" pathid="test-classpath" />
		<ivy:cachepath conf="runtime" pathid="runtime-classpath" />
		<echo message="${ivy.cache.dir}"/>
		<echo message="${ivy.default.ivy.user.dir}"/>
		<echo message="${ivy.jar.dir}"/>

		<path id="expand-compile-classpath">
			<path refid="compile-classpath"/>
			<path refid="test-classpath"/>
			<path refid="runtime-classpath"/>
		</path>
		
		<echo message="${toString:expand-compile-classpath}"></echo>
	</target>

	<target name="native">
		<native2ascii dest="WebContent/WEB-INF/i18n" src="WebContent/WEB-INF/i18n" includes="**/*.txt" ext=".properties" encoding="gbk" />
	</target>

	<target name="integration-test" depends="compile-test">
		<junit printsummary="true" haltonfailure="true" showoutput="false" fork="true">
			<jvmarg value="-javaagent:${ivy.cache.dir}/org.springframework/spring-instrument/jars/spring-instrument-${spring.version}.jar" />
			<formatter type="brief" usefile="false" />
			<formatter type="xml" if="test.reportable"/>
			<classpath>
				<path refid="expand-compile-classpath" />
				<pathelement location="${project-test-directory}" />
			</classpath>
			<!--batchtest todir="${integration-test-reports-directory}">
				<fileset dir="${project-test-directory}" includes="integrationTest/**/*Test.class" />
			</batchtest-->
			<test todir="${testReportDir}" name="integrationTest.AllTests"/>
		</junit>
	</target>

	<target name="create-integration-test-report" depends="integration-test" if="test.reportable">
		<junitreport todir="${integration-test-reports-directory}">
			<fileset dir="${integration-test-reports-directory}" includes="TEST-*.xml" />
			<report format="frames" todir="${integration-test-reports-directory}" />
		</junitreport>
		<delete includeemptydirs="true">
			<fileset dir="${unit-test-reports-directory}" includes="*.xml" />
		</delete>
	</target>

	<target name="package" depends="compile">
		<pathconvert pathsep="," property="war.libs" refid="compile-classpath">
		</pathconvert>
		<echo message="${war.libs}">
		</echo>
		<war destfile="${env.USERPROFILE}/×ÀÃæ/${DSTAMP}${ant.project.name}.war" basedir="WebContent" excludes="WEB-INF/i18n/**/*.txt">
			<classes dir="${project-class-directory}" />
			<lib dir="${work-dist-directory}" />
			<lib dir="J:/libs/spring/spring-framework-3.2.2.RELEASE/libs/" excludes="*javadoc.jar,*sources.jar,spring-webmvc-portlet-3.2.2.RELEASE.jar,spring-struts-3.2.2.RELEASE.jar,spring-instrument-3.2.2.RELEASE.jar,spring-instrument-tomcat-3.2.2.RELEASE.jar" />
			<lib dir="E:/libs/commons-logging-1.1.1/" includes="commons-logging-1.1.1.jar" />
			<lib dir="E:/libs/aopalliance/" includes="aopalliance.jar" />
			<lib dir="E:/libs/asm3.3/" includes="asm-3.3.jar" />
			<lib dir="E:/libs/aspectj-1.6.9/aspectj1.6/lib/" includes="aspectjweaver.jar,aspectjrt.jar,aspectjtools.jar" />
			<lib dir="E:/libs/cglib-2.2/" includes="cglib-2.2.jar" />
			<lib dir="E:/libs/jpa/eclipselink-plugins-2.4.1.v20121003-ad44345" includes="org.eclipse.persistence.core_2.4.1.v20121003-ad44345.jar,org.eclipse.persistence.jpa.jpql_2.0.1.v20121003-ad44345.jar,org.eclipse.persistence.jpa_2.4.1.v20121003-ad44345.jar,javax.persistence_2.0.4.v201112161009.jar,org.eclipse.persistence.antlr_3.2.0.v201206041011.jar,org.eclipse.persistence.asm_3.3.1.v201206041142.jar" />
			<lib dir="J:/libs/json/jackson/2.2" includes="jackson-annotations-2.2.0.jar,jackson-core-2.2.0.jar,jackson-databind-2.2.0.jar" />
			<lib dir="E:/libs/mysql-connector-java-5.1.23/" includes="mysql-connector-java-5.1.23-bin.jar" />
			<lib dir="E:/libs/poi-3.7/" includes="poi-ooxml-3.7-20101029.jar,poi-3.7-20101029.jar,poi-scratchpad-3.7-20101029.jar,poi-ooxml-schemas-3.7-20101029.jar" />
		</war>
	</target>

	<!--target name="zip-report">
		<zip destfile="zipReport${DSTAMP}.zip" basedir="${testReportDir}" update="true"/>
	</target>

	<target name="send-mail">
		<mail from="chenyuelin311@sohu.com" tolist="772441445@qq.com,40084863@qq.com" 
			mailhost="smtp.sohu.com" user="chenyuelin311" password="82617977" 
			subject="test" message="junit report." files="zipReport${DSTAMP}.zip"/>
	</target>

	<target name="cvs-checkout" unless="jerseySample_exists">
		<echo message="cvs-checkout"/>
		<cvs cvsroot=":pserver:developer:developer@192.168.1.254:/cvs_repository" command="checkout" dest="${basedir}" package="JerseySample" failonerror="true"/>
	</target>

	<target name="cvs-update" if="jerseySample_exists">
		<echo message="cvs-update"/>
		<cvs cvsroot=":pserver:developer:developer@192.168.1.254:/cvs_repository" command="update" dest="${basedir}" package="JerseySample" failonerror="true"/>
	</target>

	<target name="update-jerseySample" depends="cvs-checkout,cvs-update"/>

	<target name="queryTables">
		<sql driver="com.mysql.jdbc.Driver" password="w8xk73w12pz5" url="jdbc:mysql://localhost:3306/test" userid="root" print="true">
			show tables;
		</sql>
	</target-->

</project>