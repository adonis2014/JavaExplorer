<?xml version="1.0" encoding="GB18030"?>
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="Spring3MvcSample" default="native" basedir=".">

	<description>Spring3.1 MVC sample.</description>

	<import file="../base.xml" />

	<property name="spring.version" value="3.2.3.RELEASE"/>

	<property name="package.dir" value="${env.USERPROFILE}"/>
	
	<target name="initialize" depends="baseBuild.initialize">
		<ivy:cachepath conf="compile" pathid="compile-classpath" />
		<ivy:cachepath conf="test" pathid="test-classpath" />
		<ivy:cachepath conf="runtime" pathid="runtime-classpath" />
		<echo message="${ivy.cache.dir}"/>
		<echo message="${ivy.default.ivy.user.dir}"/>
		<echo message="${ivy.jar.dir}"/>
		<echo message="${ivy.instance}"/>
		<echo message="${ivy.shared.default.root}"/>
		
		<path id="expand-compile-classpath">
			<!--path refid="compile-classpath"/-->
			<path refid="test-classpath"/>
			<path refid="runtime-classpath"/>
		</path>

		<path id="expand-test-classpath">
			<path refid="test-classpath" />
			<path refid="runtime-classpath" />
		</path>

		<ivy:cachefileset setid="compile-classpath-files" conf="compile" type="jar" />
	</target>

	<target name="native">
		<property name="nativeDirectory" value="WebContent/WEB-INF/i18n"/>
		<delete>
			<fileset dir="${nativeDirectory}" includes="**/*.properties"/>
		</delete>
		<native2ascii dest="${nativeDirectory}" src="${nativeDirectory}" includes="**/*.txt" ext=".properties" encoding="gbk" />
	</target>

	<target name="compile" depends="baseBuild.compile">
		<antcall target="native"/>
	</target>
	
	<target name="integration-test" depends="compile-test">
		<echo>${basedir}</echo>
		<junit printsummary="true" haltonfailure="true" showoutput="false" fork="true" dir="${basedir}">
			<jvmarg value="-javaagent:${ivy.cache.dir}/org.springframework/spring-instrument/jars/spring-instrument-${spring.version}.jar" />
			<formatter type="brief" usefile="false" />
			<formatter type="xml" if="test.reportable"/>
			<classpath>
				<path refid="expand-compile-classpath" />
				<path refid="test-classpath" />
				<path refid="runtime-classpath" />
				<pathelement location="${project-class-directory}" />
				<pathelement location="${project-test-directory}" />
			</classpath>
			<!--batchtest todir="${integration-test-reports-directory}">
				<fileset dir="${project-test-directory}" includes="integrationTest/**/*Test.class" />
			</batchtest-->
			<test todir="${testReportDir}" name="integrationTest.AllTests"/>
		</junit>
	</target>

	<target name="create-integration-test-report" depends="integration-test" if="test.reportable">
		<junitreport todir="${integration-test-reports-directory}">
			<fileset dir="${integration-test-reports-directory}" includes="TEST-*.xml" />
			<report format="frames" todir="${integration-test-reports-directory}" />
		</junitreport>
		<delete includeemptydirs="true">
			<fileset dir="${unit-test-reports-directory}" includes="*.xml" />
		</delete>
	</target>

	<target name="package" depends="compile">
		<!--pathconvert pathsep="," property="war.libs" refid="compile-classpath">
		</pathconvert>
		<fileset dir="${ivy.cache.dir}" id="classpath.extra.lib.id">
			<include name="${war.libs}"/>
		</fileset>
		<echo message="${war.libs}"/>
		<echo message="${toString:compile-classpath}"/>
		<echo message="${classpath.extra.lib.id}"/-->
		<ivy:findrevision organisation="chenyuelin" module="jpa" revision="latest.integration" property="ivy.jpa.version"/>
		<war destfile="${package.dir}/${DSTAMP}${ant.project.name}.war" basedir="WebContent" excludes="WEB-INF/i18n/**/*.txt">
			<classes dir="${project-class-directory}" />
			<lib file="${ivy.cache.dir}/aopalliance/aopalliance/jars/aopalliance-1.0.jar"/>
			<lib file="${ivy.cache.dir}/commons-logging/commons-logging/jars/commons-logging-1.1.3.jar" />
			<lib file="${ivy.cache.dir}/org.aspectj/aspectjrt/jars/aspectjrt-1.7.3.jar" />
			<lib file="${ivy.cache.dir}/org.aspectj/aspectjweaver/jars/aspectjweaver-1.7.3.jar" />
			
			<lib file="${ivy.cache.dir}/com.fasterxml.jackson.core/jackson-annotations/jars/jackson-annotations-2.2.2.jar" />
			<lib file="${ivy.cache.dir}/com.fasterxml.jackson.core/jackson-core/jars/jackson-core-2.2.2.jar" />
			<lib file="${ivy.cache.dir}/com.fasterxml.jackson.core/jackson-databind/jars/jackson-databind-2.2.2.jar" />
			
			<lib file="${ivy.cache.dir}/org.eclipse.persistence/javax.persistence/jars/javax.persistence-2.1.0.jar" />
			<lib file="${ivy.cache.dir}/org.eclipse.persistence/org.eclipse.persistence.antlr/jars/org.eclipse.persistence.antlr-2.5.0.jar" />
			<lib file="${ivy.cache.dir}/org.eclipse.persistence/org.eclipse.persistence.asm/jars/org.eclipse.persistence.asm-2.5.0.jar" />
			<lib file="${ivy.cache.dir}/org.eclipse.persistence/org.eclipse.persistence.core/jars/org.eclipse.persistence.core-2.5.0.jar" />
			<lib file="${ivy.cache.dir}/org.eclipse.persistence/org.eclipse.persistence.jpa/jars/org.eclipse.persistence.jpa-2.5.0.jar" />
			<lib file="${ivy.cache.dir}/org.eclipse.persistence/org.eclipse.persistence.jpa.jpql/jars/org.eclipse.persistence.jpa.jpql-2.5.0.jar" />
			
			<lib file="${ivy.cache.dir}/org.springframework/spring-aop/jars/spring-aop-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-aspects/jars/spring-aspects-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-beans/jars/spring-beans-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-context/jars/spring-context-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-core/jars/spring-core-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-expression/jars/spring-expression-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-jdbc/jars/spring-jdbc-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-jms/jars/spring-jms-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-orm/jars/spring-orm-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-oxm/jars/spring-oxm-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-tx/jars/spring-tx-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-web/jars/spring-web-${spring.version}.jar" />
			<lib file="${ivy.cache.dir}/org.springframework/spring-webmvc/jars/spring-webmvc-${spring.version}.jar" />
			
			<lib file="${ivy.cache.dir}/org.apache.poi/poi/jars/poi-3.9.jar" />
			<lib file="${ivy.cache.dir}/org.apache.poi/poi-ooxml/jars/poi-ooxml-3.9.jar" />
			<lib file="${ivy.cache.dir}/org.apache.poi/poi-ooxml-schemas/jars/poi-ooxml-schemas-3.9.jar" />
			<lib file="${ivy.cache.dir}/org.apache.poi/poi-scratchpad/jars/poi-scratchpad-3.9.jar" />
			
			<lib file="${ivy.shared.default.root}/chenyuelin/jpa/${ivy.jpa.version}/jars/jpa.jar" />
		</war>
	</target>

	<!--target name="zip-report">
		<zip destfile="zipReport${DSTAMP}.zip" basedir="${testReportDir}" update="true"/>
	</target>

	<target name="send-mail">
		<mail from="chenyuelin311@sohu.com" tolist="772441445@qq.com,40084863@qq.com" 
			mailhost="smtp.sohu.com" user="chenyuelin311" password="82617977" 
			subject="test" message="junit report." files="zipReport${DSTAMP}.zip"/>
	</target>

	<target name="cvs-checkout" unless="jerseySample_exists">
		<echo message="cvs-checkout"/>
		<cvs cvsroot=":pserver:developer:developer@192.168.1.254:/cvs_repository" command="checkout" dest="${basedir}" package="JerseySample" failonerror="true"/>
	</target>

	<target name="cvs-update" if="jerseySample_exists">
		<echo message="cvs-update"/>
		<cvs cvsroot=":pserver:developer:developer@192.168.1.254:/cvs_repository" command="update" dest="${basedir}" package="JerseySample" failonerror="true"/>
	</target>

	<target name="update-jerseySample" depends="cvs-checkout,cvs-update"/>

	<target name="queryTables">
		<sql driver="com.mysql.jdbc.Driver" password="w8xk73w12pz5" url="jdbc:mysql://localhost:3306/test" userid="root" print="true">
			show tables;
		</sql>
	</target-->

</project>