<!DOCTYPE html>
<html>
<head>
<meta charset="GB18030">
<title>FileRead</title>
<script src="../js/lib/jquery-2.1.0.js"></script>
<script src="../js/lib/jquery.csv-0.71.min.js"></script>
<script>
	$().ready(function() {
		$("#a-sample").click(function() {
			alert(11);
			return false;
		});

		$("#f1-sub").click(function() {
			var $file = $("#f1-file");
			var fileReader = new FileReader();
			fileReader.readAsText($file[0].files[0], "GB18030");
			fileReader.onloadend = function() {
				/* var words = CryptoJS.enc.Latin1.parse(fileReader.result);
				var utf8 = CryptoJS.enc.Latin1.stringify(words); */
				$("#r1").text(fileReader.result);
				var arrays = $.csv.toArrays(fileReader.result);
				//$.csv.fromArrays(arrays);
			}
			return false;
		});

		$("#a-download-image4").click(function() {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', '/SpringMvc3.1/upload/download1/0035.jpg', true);
			xhr.responseType = 'blob';
			xhr.overrideMimeType("application/octet-stream;");
			xhr.onload = function(load) {
				var blob = this.response;
				var $a = $("<a>fff</a>");
				$a.attr("download", "test.jpg");
				$a.attr("href", URL.createObjectURL(blob));
				$(document.body).append($a);
				//$a.trigger("click");
				$a[0].click();
				$a.remove();
				URL.revokeObjectURL(blob);
			}
			xhr.send();
			return false;
		});

		$("#a-download-image5").click(function() {
			$.ajax("/SpringMvc3.1/upload/download1/0035.jpg", {
				xhrFields : {
					responseType : "blob"
				},
				contents : {
					application : /application/
				},
				converters : {
					"text application" : function() {
						alert(11)
					}
				},
				success : function(data, textStatus, jqXHR) {
					alert(data);
				},
				error : function(jqXHR, textStatus, errorThrown) {
					alert(textStatus);
				}
			});
			return false;
		});
		
		$("#uploadform>input:last").click(function(){
			var formData = new FormData(document.getElementById("uploadform"));
			/* $.ajax("/SpringMvc3.1/upload/one", {
				processData :false,
				type:"POST",
				contentType :"multipart/form-data",
				data:formData,
				success : function(data, textStatus, jqXHR) {
					alert(data);
				},
				error : function(jqXHR, textStatus, errorThrown) {
					alert(textStatus);
				}
			}); */
			var xhr = new XMLHttpRequest();
			xhr.open('POST', '/SpringMvc3.1/upload/one', true);
			xhr.upload.onprogress = function(progress){
				if(progress.lengthComputable){
					//loaded
					//total
					console.debug(progress.loaded+"/"+progress.total)
				}
			};
			xhr.onreadystatechange = function(){
				console.debug(this.readyState+"*"+this.status)
				if(this.status===200){
					if(this.readyState === 4){
						alert(this.status+"\n"+this.statusText);
					}
				}else{
					if(this.readyState === 4){
						alert(this.status+"\n"+this.statusText);
					}
					
				}
			};
			xhr.send(formData);
			return false;
		});
		
		$("#form2>input:last").click(function(){
			var oMyBlob = new Blob(["ƒ„∫√∞°°£"], { "type" : "text/plain;charset=GB18030" });
			var fileReader = new FileReader();
			fileReader.readAsText(oMyBlob, "utf-8");
			fileReader.onloadend = function() {
				/* var words = CryptoJS.enc.Latin1.parse(fileReader.result);
				var utf8 = CryptoJS.enc.Latin1.stringify(words); */
				$("#r1").text(fileReader.result);
				//var arrays = $.csv.toArrays(fileReader.result);
				//$.csv.fromArrays(arrays);
			}
			return false;
			return false;
		});
	});
</script>
</head>
<body>
	<form>
		<input type="file" name="file1" multiple="multiple" id="f1-file"> <input type="submit" id="f1-sub">
	</form>
	<div style="border-style: solid; border-color: green; border-width: 2px">
		<form id="uploadform" enctype="multipart/form-data" action="/SpringMvc3.1/upload/one/" method="post">
			<input type="text" name="name" /><br /> <input type="file" name="files" multiple="multiple" /><br /> <input type="submit" />
		</form>
	</div>
	<div id="r1"></div>
	<a id="a-sample" href="#">test</a>
	<a href="/SpringMvc3.1/upload/download1/0035.jpg">œ¬‘ÿÕº∆¨1</a>
	<a href="/SpringMvc3.1/upload/download2/0035.jpg">œ¬‘ÿÕº∆¨2</a>
	<a href="/SpringMvc3.1/upload/download3/0035.jpg">œ¬‘ÿÕº∆¨3</a>
	<a id="a-download-image4" href="#">œ¬‘ÿÕº∆¨4</a>
	<a id="a-download-image5" href="#">œ¬‘ÿÕº∆¨5</a>
	<div id="div-hide" style="display: none;"></div>
	<form id="form2">
		<input type="file" name="file1" multiple="multiple"> 
		<input type="submit">
	</form>
</body>
</html>