(function($){$.fn.fixheadertable=function(P){var Q=util_getScrollbarWidth();var R={id:Math.round(Math.random()*10000)+"","class":"",caption:'',showhide:true,theme:'ui',height:null,width:null,minWidth:null,minWidthAuto:false,colratio:[],whiteSpace:'nowrap',addTitles:false,zebra:false,zebraClass:'ui-state-active',sortable:false,sortedColId:null,sortType:[],dateFormat:'d-m-y',pager:false,rowsPerPage:10,resizeCol:false,minColWidth:100,wrapper:true};var P=$.extend(R,P);function util_getComputedStyle(a,b){if(a.currentStyle){var y=x.currentStyle[b]}else if(window.getComputedStyle){var y=document.defaultView.getComputedStyle(a,null).getPropertyValue(b)}return y}function util_getScrollbarWidth(){var a=$('<p/>').addClass('t_fixed_header_scroll_inner');var b=$('<div/>').addClass('t_fixed_header_scroll_outer');b.append(a);$(document.body).append(b);var c=a[0].offsetWidth;b.css('overflow','scroll');var d=a[0].offsetWidth;if(c==d){d=b[0].clientWidth}b.remove();return(c-d)}function util_parseDate(b,c){var d={m:1,d:1,y:1970,h:0,i:0,s:0},k,hl,dM;if(c&&c!==null&&c!==undefined){c=$.trim(c);c=c.split(/[\\\/:_;.\t\T\s-]/);b=b.split(/[\\\/:_;.\t\T\s-]/);var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"];var f=["am","pm","AM","PM"];var g=function(a,h){if(a===0){if(h==12){h=0}}else{if(h!=12){h+=12}}return h};for(k=0,hl=b.length;k<hl;k++){if(b[k]=='M'){dM=$.inArray(c[k],e);if(dM!==-1&&dM<12){c[k]=dM+1}}if(b[k]=='F'){dM=$.inArray(c[k],e);if(dM!==-1&&dM>11){c[k]=dM+1-12}}if(b[k]=='a'){dM=$.inArray(c[k],f);if(dM!==-1&&dM<2&&c[k]==f[dM]){c[k]=dM;d.h=g(c[k],d.h)}}if(b[k]=='A'){dM=$.inArray(c[k],f);if(dM!==-1&&dM>1&&c[k]==f[dM]){c[k]=dM-2;d.h=g(c[k],d.h)}}if(c[k]!==undefined){d[b[k].toLowerCase()]=parseInt(c[k],10)}}d.m=parseInt(d.m,10)-1;var i=d.y;if(i>=70&&i<=99){d.y=1900+d.y}else if(i>=0&&i<=69){d.y=2000+d.y}}return new Date(d.y,d.m,d.d,d.h,d.i,d.s,0)}function isIE6_7(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var a=new Number(RegExp.$1);if(a==7||a==6){return true}else{return false}}}function isIE8(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var a=new Number(RegExp.$1);if(a==8){return true}else{return false}}}function adaptScroll(a,b){var c=Q;var d=null;if(isIE6_7()){c=0}var e=0;if(parseInt($(b).height())>parseInt(P.height)){e=c;d='scroll'}else{e=0;d='auto'}if($.support.opacity===false&&P.height){e=c;d='scroll'}a.css('margin-right',e);return d}this.data("adaptScroll",adaptScroll);return this.each(function(){var h=$(this);var k=null;var l=$('thead th',this).length;var m=$(this).width();var n=null;var o=null;var p=null;var q=null;var r=null;var s=Q;var t=buildColgroup(l);var u=null;var v=10;var w=null;var z=null;var A=null;var B=null;var C=null;var D=null;var E=/[\$,%]/g;var F=null;var G=null;function buildTop(a){p=$('<div class="headtable ui-state-default" style="margin-right : 0px"></div>');o=p;o.insertBefore(a)}function buildColgroup(a){var b=$('<colgroup />');if(P.colratio.length==0){var c=null;for(var i=0;i<a;i++){c=$('<col style="width : '+(100/a)+'%" />');b.append(c);c=null}}else if(P.colratio.length==a){var d=0;for(var i=0;i<a;i++){c=$('<col style="width : '+P.colratio[i]+'px" />');b.append(c);c=null;d+=parseInt(P.colratio[i])}$(h).css('width',d+'px')}return b}function sortColumn(c,d,e,f){if((P.sortType.length!=0)&&(P.sortType.length==l)){var g=P.sortType[d];if(g=='float'){getSortKey=function(a){var b=parseFloat(String(a).replace(E,''));return isNaN(b)?0.00:b}}else if(g=='integer'){getSortKey=function(a){return a?parseFloat(String(a).replace(E,'')):0}}else if(g=='date'){getSortKey=function(a){return util_parseDate(P.dateFormat,a).getTime()}}else{getSortKey=function(a){if(!a){a=""}return $.trim(String(a).toLowerCase())}}}else{getSortKey=function(a){if(!a){a=""}return $.trim(String(a).toLowerCase())}}D.sort(function(a,b){var x=getSortKey(a[d]);var y=getSortKey(b[d]);return((x<y)?-1:((x>y)?1:0))});if(e=='DESC'){D.reverse()}(P.pager)?moveToPage(c):objectToTable(D,c)}function objectToTable(a,b){var c=$('tbody',b);c.children().remove();if(P.zebra){for(var i=0;i<a.length;i++){(i%2)?(tr=$('<tr class="'+P.zebraClass+'"></tr>')):(tr=$('<tr></tr>'));for(var j in a[i]){tr.append($('<td class="ui-widget-content"></td>').html(a[i][j]))}c.append(tr)}}else{for(var i=0;i<a.length;i++){tr=$('<tr></tr>');for(var j in a[i]){tr.append($('<td class="ui-widget-content"></td>').html(a[i][j]))}c.append(tr)}}}function tableToObject(b){var c=[];$('tr',b).each(function(i){var a={};$('td',this).each(function(j){a[j]=$(this).html()});c.push(a)});return c}function buildHeaders(c){r=$('<table class="head"/>').append(t).append($('thead',c));o.append(r);r.wrap('<div></div>');var d=$('th',r);d.addClass('ui-widget-content ui-state-default');if(P.sortable){var f=null;d.each(function(i){$(this).contents().wrapAll('<div class="ui-sort"></div>');f=$('div.ui-sort',this);f.click(function(){d.removeClass('ui-state-hover');$(this).parent().removeClass('ui-state-active').addClass('ui-state-hover');$('span.ui-icon',d).remove();if($(this).hasClass('sortedUp')){sortColumn(c,i,"DESC",this);$(this).removeClass('sortedUp').addClass('sortedDown');$(this).append('<span style="display : inline-block; vertical-align : middle" class="ui-icon ui-icon-triangle-1-s"></span>')}else{sortColumn(c,i,"ASC",this);$(this).removeClass('sortedDown').addClass('sortedUp');$(this).append('<span style="display : inline-block; vertical-align : middle" class="ui-icon ui-icon-triangle-1-n"></span>')}o[0].scrollLeft=q[0].scrollLeft})});$('div.ui-sort',d).addClass('hover')}if(P.resizeCol&&(P.colratio.length==l)){d.each(function(i){var a=$('<span class="ui-resize"></span>');$(this).prepend(a);a.mousedown(function(e){dragStart(i,e);return false})});_main_wrapper.mousemove(function(e){if(F){dragMove(e);return false}}).mouseup(function(){if(F){dragEnd();return false}return true});function getOffset(a){var b=0,cell=$('col',t),handler=$('th > span.ui-resize',r)[a],bso=q[0].scrollLeft;for(var i=0;i<a;i++){b+=parseInt(cell[i].style.width)}return handler.offsetLeft+5+b-bso}function dragStart(i,x){F={id:i,startX:x.clientX,initTableWidth:getColratioWidth(),offset:getOffset(i)};G.css({display:'block',height:o.height()+q.height()+2+'px',left:F.offset+'px',cursor:'col-resize'})}function dragMove(x){var a=x.clientX-F.startX;F.newWidth=parseInt($('col',t)[F.id].style.width)+a;F.newTableWidth=F.initTableWidth+a;if(F.newWidth>parseInt(P.minColWidth)){G.css({left:F.offset+a+'px'})}else{F.newWidth=parseInt(P.minColWidth)}}function dragEnd(){$(t.children()[F.id]).css({width:F.newWidth+'px'});$(u.children()[F.id]).css({width:F.newWidth+'px'});var a=F.newTableWidth;r.css({'width':a+'px'});$(h).css({'width':a+'px'});F=null;G.css({display:'none'});o[0].scrollLeft=q[0].scrollLeft}}}function buildBody(a){q=$('<div class="body ui-widget-content"></div>').insertBefore(a).append(a);if(P.height!=null&&!isNaN(parseInt(P.height))){q.css('height',P.height+'px')}u=t.clone();$(a).prepend(u);$('td',a).addClass('ui-widget-content');$(a).wrap('<div></div>');if(P.addTitles==true){$('td',a).each(function(){$(this).attr('title',$(this).text())})}if(P.zebra){$('tr:odd',a).addClass(P.zebraClass)}}function restrictRows(a,b){var c=D.length;var d=0;if(c<b){d=c}else{d=b}var e=D.slice(0,d);objectToTable(e,a);z=Math.ceil(c/b);B=1;A.html('Showing page '+B+' of '+z);q.css('overflow-y',adaptScroll(p,a));$('tr:last td',a).css('border-bottom-width','1px')}function moveToNextPage(a){B++;if(B>=(z)){B=(z)}moveToPage(a)}function moveToPreviousPage(a){B--;if(B<=1){B=1}moveToPage(a)}function moveToPage(a){var b=D.length;var c,limit=0;c=(B-1)*w;if(b<(B*w)){limit=b}else{limit=(B*w)}var d=D.slice(c,limit);objectToTable(d,a);A.html('Showing page '+B+' of '+z);q.css('overflow-y',adaptScroll(p,a));$('tr:last td',a).css('border-bottom-width','1px')}function buildNavButton(a,b,c){var d=$('<div class="button ui-state-default '+c+'"><span class="ui-icon '+a+'">&nbsp;</span></div>');C.append(d);d.mouseover(function(){$(this).addClass('ui-state-hover')}).mousedown(function(){$(this).addClass('ui-state-active')}).mouseup(function(){$(this).removeClass('ui-state-active')}).mouseout(function(){$(this).removeClass('ui-state-active');$(this).removeClass('ui-state-hover')}).click(b)}function buildPager(a){C=$('<div class="pager ui-widget-header ui-corner-bottom ui-widget-content"></div>');_main_wrapper.append(C);buildNavButton('ui-icon-arrowthickstop-1-e',function(){B=z;moveToPage(a)},'ui-corner-right');buildNavButton('ui-icon ui-icon-arrowthick-1-e',function(){moveToNextPage(a)},'noborder');buildNavButton('ui-icon ui-icon-arrowthick-1-w',function(){moveToPreviousPage(a)},'noborder');buildNavButton('ui-icon-arrowthickstop-1-w',function(){B=1;moveToPage(a)},'ui-corner-left noborder');_button_set=$('<div id="'+a.id+'_radio" style="float : left">'+'<input type="radio" id="'+a.id+'_show_10_rows" name="'+a.id+'_radio"/><label for="'+a.id+'_show_10_rows">10</label>'+'<input type="radio" id="'+a.id+'_show_25_rows" name="'+a.id+'_radio"/><label for="'+a.id+'_show_25_rows">25</label>'+'<input type="radio" id="'+a.id+'_show_50_rows" name="'+a.id+'_radio" /><label for="'+a.id+'_show_50_rows">50</label>'+'<input type="radio" id="'+a.id+'_show_100_rows" name="'+a.id+'_radio"/><label for="'+a.id+'_show_100_rows">100</label>'+'</div>');C.append(_button_set);$('#'+a.id+'_show_10_rows',C).click(function(){w=v;restrictRows(a,w)});$('#'+a.id+'_show_25_rows',C).click(function(){w=v*2.5;restrictRows(a,w)});$('#'+a.id+'_show_50_rows',C).click(function(){w=v*5;restrictRows(a,w)});$('#'+a.id+'_show_100_rows',C).click(function(){w=v*10;restrictRows(a,w)});A=$('<div class="page_infos"></div>');C.append(A);w=v;$('#'+a.id+'_show_'+P.rowsPerPage+'_rows',C).click();_button_set.buttonset()}function getColratioWidth(){var a=0;for(var i=0;i<P.colratio.length;i++){a+=parseInt(P.colratio[i])}return a}n=$('<div/>').addClass('t_fixed_header ui-state-default default '+P.theme).insertBefore(this).append(this);n.css('border','none').css('font-weight','normal');_main_wrapper=$('<div class="t_fixed_header_main_wrapper ui-widget ui-widget-header '+P.theme+'"></div>');if(P.whiteSpace=='normal'){n.addClass('t_fixed_header_wrap')}buildTop(this);buildHeaders(this);buildBody(this);if(P.wrapper){var H=$('<div class="ui-widget ui-widget-content ui-corner-all" style="padding : 5px; font-size : 1em;"></div>');H.attr("id",P.id);H.addClass(P["class"]);var I=n.wrap(H).parent()}else{var H=$('<div></div>');H.attr("id",P.id);H.addClass(P["class"]);var I=n.wrap(H).parent()}if(P.width!=null&&!isNaN(parseInt(P.width))&&P.width>0){I.css('width',P.width+'px')}var J=n.detach();var K=$('<div class="t_fixed_header_main_wrapper_child"></div>');_main_wrapper.append(K);K.append(J);I.append(_main_wrapper);if(isIE6_7()){q.css('margin-bottom',17+'px')}if(P.caption!=''){var L=$('<div class="t_fixed_header_caption ui-widget-header ui-corner-top">'+P.caption+'</div>');_main_wrapper.prepend(L).addClass('ui-corner-all');if(P.showhide){var M=$('<div style="cursor : pointer; display : inline-block; vertical-align : middle; background : none; border : none;" class="ui-state-active"><span class="ui-icon ui-icon-triangle-1-n">&nbsp;</span></div>');L.append(M);M.click(function(){K.toggle();L.toggleClass('toggle');if(C){C.toggle()}$('span',M).toggleClass('ui-icon-triangle-1-s')})}}if(P.sortable||P.pager){D=tableToObject(this)}if(P.pager){buildPager(this)}if(P.sortable&&!isNaN(parseInt(P.sortedColId))){var N=$('th',r)[P.sortedColId];$(N).addClass('ui-state-hover');$('div.ui-sort',N).click()}if(P.resizeCol&&(P.colratio.length==l)){G=$('<div class="ui-resize-ghost ui-widget-header" style="height : '+_main_wrapper.parent().height()+'px"></div>');n.append(G)}q.css('overflow-y',adaptScroll(p,this));if(P.minWidth!=null&&!isNaN(parseInt(P.minWidth))&&P.minWidth>0){var O=P.minWidth+'px'}else if(P.minWidthAuto){if(P.colratio.length==l){var O=$(this).width()+'px'}else{var O=(m+150)+'px'}}o.children().first().css('min-width',O);q.children().first().css('min-width',O);q.scroll(function(){o[0].scrollLeft=q[0].scrollLeft});if(P.colratio.length==l){n.removeClass('default');$(r).css('width',getColratioWidth()+'px')}})}})(jQuery);